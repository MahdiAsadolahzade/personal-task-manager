(()=>{async function i(){let i=await n(),e=new Date().getTime();for(let n of i)n.scheduledTime&&new Date(n.scheduledTime).getTime()<=e&&(self.registration.showNotification(n.title,{body:n.message,icon:"/icons/icon-192x192.png",badge:"/icons/icon-72x72.png"}),await t(n.id))}async function n(){return new Promise(i=>{indexedDB.open("notification-store").onsuccess=n=>{let t=n.target.result.transaction("notifications","readonly").objectStore("notifications").getAll();t.onsuccess=()=>i(t.result)}})}async function t(i){return new Promise(n=>{indexedDB.open("notification-store").onsuccess=t=>{let e=t.target.result.transaction("notifications","readwrite");e.objectStore("notifications").delete(i),e.oncomplete=()=>n()}})}self.addEventListener("push",function(i){var n;let t=null==(n=i.data)?void 0:n.json(),e=(null==t?void 0:t.title)||"Notification",o={body:(null==t?void 0:t.message)||"",icon:"/icons/icon-192x192.png",badge:"/icons/icon-72x72.png",vibrate:[200,100,200],data:{url:(null==t?void 0:t.url)||"/",id:null==t?void 0:t.id}};i.waitUntil(self.registration.showNotification(e,o))}),self.addEventListener("notificationclick",function(i){i.notification.close(),i.waitUntil(clients.matchAll({type:"window"}).then(n=>{var t;let e=(null==(t=i.notification.data)?void 0:t.url)||"/";for(let i of n)if(i.url===e&&"focus"in i)return i.focus();if(clients.openWindow)return clients.openWindow(e)}))}),self.addEventListener("sync",function(n){"sync-scheduled-notifications"===n.tag&&n.waitUntil(i())})})();