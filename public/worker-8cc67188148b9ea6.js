(()=>{async function t(){let t=await new Promise(t=>{let n=indexedDB.open("notification-store");n.onsuccess=n=>{let i=n.target.result;if(!i.objectStoreNames.contains("notifications"))return void t([]);let e=i.transaction("notifications","readonly").objectStore("notifications").getAll();e.onsuccess=()=>t(e.result),e.onerror=()=>t([])},n.onerror=()=>t([])}),n=Date.now();for(let i of t)i.scheduledTime&&new Date(i.scheduledTime).getTime()<=n&&(await self.registration.showNotification(i.title,{body:i.message,icon:"/icons/icon-192x192.png",badge:"/icons/icon-72x72.png"}),await function(t){return new Promise(n=>{let i=indexedDB.open("notification-store");i.onsuccess=i=>{let e=i.target.result;if(!e.objectStoreNames.contains("notifications"))return void n();let o=e.transaction("notifications","readwrite");o.objectStore("notifications").delete(t),o.oncomplete=()=>n()},i.onerror=()=>n()})}(i.id))}async function n(){console.log("Running background sync task...")}self.addEventListener("push",function(t){var n;let i=null==(n=t.data)?void 0:n.json(),e=(null==i?void 0:i.title)||"Notification",o={body:(null==i?void 0:i.message)||"",icon:"/icons/icon-192x192.png",badge:"/icons/icon-72x72.png",vibrate:[200,100,200],data:{url:(null==i?void 0:i.url)||"/",id:null==i?void 0:i.id}};t.waitUntil(self.registration.showNotification(e,o))}),self.addEventListener("notificationclick",function(t){t.notification.close(),t.waitUntil(clients.matchAll({type:"window",includeUncontrolled:!0}).then(n=>{var i;let e=(null==(i=t.notification.data)?void 0:i.url)||"/";for(let t of n)if(t.url===e&&"focus"in t)return t.focus();return clients.openWindow(e)}))}),self.addEventListener("sync",function(n){n.tag.startsWith("notif-")&&n.waitUntil(t())}),self.addEventListener("periodicsync",t=>{"my-sync-tag"===t.tag&&t.waitUntil(n())})})();