(()=>{async function t(){let t=await new Promise(t=>{let i=indexedDB.open("notification-store");i.onsuccess=i=>{let n=i.target.result;if(!n.objectStoreNames.contains("notifications"))return void t([]);let e=n.transaction("notifications","readonly").objectStore("notifications").getAll();e.onsuccess=()=>t(e.result),e.onerror=()=>t([])},i.onerror=()=>t([])}),i=Date.now();for(let n of t)n.scheduledTime&&new Date(n.scheduledTime).getTime()<=i&&(await self.registration.showNotification(n.title,{body:n.message,icon:"/icons/icon-192x192.png",badge:"/icons/icon-72x72.png"}),await function(t){return new Promise(i=>{let n=indexedDB.open("notification-store");n.onsuccess=n=>{let e=n.target.result;if(!e.objectStoreNames.contains("notifications"))return void i();let o=e.transaction("notifications","readwrite");o.objectStore("notifications").delete(t),o.oncomplete=()=>i()},n.onerror=()=>i()})}(n.id))}self.addEventListener("push",function(t){var i;let n=null==(i=t.data)?void 0:i.json(),e=(null==n?void 0:n.title)||"Notification",o={body:(null==n?void 0:n.message)||"",icon:"/icons/icon-192x192.png",badge:"/icons/icon-72x72.png",vibrate:[200,100,200],data:{url:(null==n?void 0:n.url)||"/",id:null==n?void 0:n.id}};t.waitUntil(self.registration.showNotification(e,o))}),self.addEventListener("notificationclick",function(t){t.notification.close(),t.waitUntil(clients.matchAll({type:"window",includeUncontrolled:!0}).then(i=>{var n;let e=(null==(n=t.notification.data)?void 0:n.url)||"/";for(let t of i)if(t.url===e&&"focus"in t)return t.focus();return clients.openWindow(e)}))}),self.addEventListener("sync",function(i){i.tag.startsWith("notif-")&&i.waitUntil(t())})})();